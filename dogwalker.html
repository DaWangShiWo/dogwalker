<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SniffMap | æ¢ç´¢ç‹—ç‹—çœ¼ä¸­çš„ä¸–ç•Œ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        :root {
            --primary: #FF6B6B; /* æ´»åŠ›çº¢ */
            --secondary: #4ECDC4; /* æ¸…æ–°ç»¿ */
            --dark: #2C3E50;
            --light: #F7F9FC;
        }

        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; }

        /* åœ°å›¾å®¹å™¨ */
        #map { height: 100vh; width: 100%; z-index: 1; }

        /* ä¾§è¾¹æ /æµ®åŠ¨å¡ç‰‡ */
        .sidebar {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
        }

        .logo { font-size: 24px; font-weight: 800; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--primary); }

        /* è·¯çº¿å¡ç‰‡æ ·å¼ */
        .route-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }
        .route-card:hover { transform: translateY(-2px); border-color: var(--secondary); }
        .route-card.active { border-left: 4px solid var(--secondary); background: #f0fffd; }
        
        .route-title { font-weight: 700; color: var(--dark); display: flex; justify-content: space-between; }
        .route-tags { display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap; }
        .tag { font-size: 10px; padding: 3px 8px; border-radius: 20px; font-weight: 600; }
        
        .tag.easy { background: #e6fffa; color: #00b894; } /* é€‚åˆå°ç‹— */
        .tag.mod { background: #fff8e1; color: #ffa502; }
        .tag.social { background: #e3f2fd; color: #0984e3; }

        .route-stats { display: flex; gap: 15px; margin-top: 10px; font-size: 12px; color: #666; }

        /* åº•éƒ¨è®°å½•æ§åˆ¶æ¡ */
        .control-bar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            width: auto;
        }

        .btn-record {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn-record:active { transform: scale(0.95); }

        .stats-display { text-align: center; }
        .stats-val { font-size: 18px; font-weight: 700; }
        .stats-label { font-size: 10px; opacity: 0.7; }

        /* è‡ªå®šä¹‰åœ°å›¾æ ‡è®°æ ·å¼ */
        .emoji-icon { font-size: 24px; text-align: center; line-height: 1; text-shadow: 2px 2px 0px #fff; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-dog"></i> SniffMap</div>
        
        <h3>å®¶é™„è¿‘æ¨è (Nearby)</h3>
        
        <div id="route-list">
            </div>

        <div style="margin-top: 20px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 12px; color: #856404;">
            <i class="fas fa-exclamation-triangle"></i> 
            <strong>é¿å‘æç¤ºï¼š</strong> åŒ—åŒºè‰åªè¿‘æœŸåœ¨å–·æ´’é™¤è™«å‰‚ï¼Œè¯·ç»•è¡Œã€‚
        </div>
    </div>

    <div class="control-bar">
        <div class="stats-display">
            <div class="stats-val" id="timer">00:00</div>
            <div class="stats-label">æ—¶é•¿</div>
        </div>
        
        <div class="btn-record" onclick="toggleRecord()">
            <i class="fas fa-play" id="play-icon"></i>
        </div>

        <div class="stats-display">
            <div class="stats-val">0.00</div>
            <div class="stats-label">å…¬é‡Œ</div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // 1. åˆå§‹åŒ–åœ°å›¾ (è®¾ç½®ä¸­å¿ƒç‚¹ä¸ºç¤ºä¾‹å…¬å›­ä½ç½®)
        const map = L.map('map').setView([31.224361, 121.469170], 15); // ç¤ºä¾‹ï¼šä¸Šæµ·é™å®‰åŒºé™„è¿‘

        // 2. åŠ è½½åœ°å›¾åº•å›¾ (OpenStreetMap - å…è´¹ä¸”å‹å¥½)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap & CartoDB',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // 3. å®šä¹‰æ¨¡æ‹Ÿæ•°æ® (è·¯çº¿åº“)
        const routes = [
            {
                id: 1,
                name: "é˜³å…‰è‰åªæ…¢èµ°",
                desc: "éå¸¸é€‚åˆå°å‹çŠ¬ï¼Œå…¨ç¨‹å¹³è·¯ï¼Œæ— å°é˜¶ã€‚",
                distance: "1.2 km",
                time: "20 min",
                tags: ["easy", "small-dog"],
                color: "#00b894", // ç»¿è‰²ä»£è¡¨è½»æ¾
                coords: [
                    [31.224361, 121.469170],
                    [31.225000, 121.470000],
                    [31.226000, 121.468000],
                    [31.224361, 121.469170]
                ]
            },
            {
                id: 2,
                name: "æ²³æ»¨æ¢ç´¢æ­¥é“",
                desc: "æ²¿æ²³é£æ™¯å¥½ï¼Œæœ‰ä¸“é—¨çš„ç‹—ç‹—é¥®æ°´ç‚¹ã€‚",
                distance: "3.5 km",
                time: "45 min",
                tags: ["mod", "scenic"],
                color: "#0984e3", // è“è‰²ä»£è¡¨é£æ™¯
                coords: [
                    [31.222000, 121.465000],
                    [31.223000, 121.462000],
                    [31.228000, 121.464000],
                    [31.230000, 121.460000]
                ]
            },
            {
                id: 3,
                name: "å‘¨æœ«ç¤¾äº¤èšä¼šåœˆ",
                desc: "è¿™é‡Œæœ‰å¾ˆå¤šæŸ¯åŸºå’Œæ³°è¿ªå‡ºæ²¡ï¼",
                distance: "0.8 km",
                time: "60 min", // ä¸»è¦æ˜¯ç©ï¼Œä¸æ˜¯èµ°
                tags: ["easy", "social"],
                color: "#fdcb6e", // é»„è‰²ä»£è¡¨ç¤¾äº¤
                coords: [
                    [31.226500, 121.472000],
                    [31.227500, 121.473000],
                    [31.227000, 121.474000],
                    [31.226000, 121.473000]
                ]
            }
        ];

        // 4. å®šä¹‰ç‰¹æ®Šçš„æ ‡è®° (POI)
        const addMarker = (lat, lng, icon, text) => {
            L.marker([lat, lng], {
                icon: L.divIcon({
                    html: `<div class="emoji-icon">${icon}</div>`,
                    className: 'dummy',
                    iconSize: [30, 30]
                })
            }).addTo(map).bindPopup(text);
        };

        // æ·»åŠ ä¸€äº›è®¾æ–½æ ‡è®°
        addMarker(31.225000, 121.470000, 'ğŸš°', 'å® ç‰©ç›´é¥®æ°´');
        addMarker(31.227500, 121.473000, 'ğŸ’©', 'å® ç‰©ä¾¿ä¾¿è¢‹é¢†å–ç‚¹');
        addMarker(31.223000, 121.462000, 'â˜•', 'æ±ªæ±ªå‹å¥½å’–å•¡é¦†');

        // 5. æ¸²æŸ“è·¯çº¿åˆ—è¡¨å’Œåœ°å›¾çº¿æ¡
        const routeListEl = document.getElementById('route-list');
        let activePolyline = null;

        routes.forEach(route => {
            // æ¸²æŸ“åˆ—è¡¨å¡ç‰‡
            const card = document.createElement('div');
            card.className = 'route-card';
            
            // ç”Ÿæˆæ ‡ç­¾HTML
            let tagsHtml = '';
            if(route.tags.includes('easy')) tagsHtml += `<span class="tag easy"><i class="fas fa-paw"></i> é€‚åˆå°ç‹—</span>`;
            if(route.tags.includes('mod')) tagsHtml += `<span class="tag mod">å¾’æ­¥</span>`;
            if(route.tags.includes('social')) tagsHtml += `<span class="tag social">ç¤¾äº¤</span>`;

            card.innerHTML = `
                <div class="route-title">${route.name}</div>
                <div class="route-tags">${tagsHtml}</div>
                <div style="font-size:12px; color:#888; margin:5px 0;">${route.desc}</div>
                <div class="route-stats">
                    <span><i class="fas fa-road"></i> ${route.distance}</span>
                    <span><i class="fas fa-clock"></i> ${route.time}</span>
                </div>
            `;
            
            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            card.onclick = () => {
                // æ¸…é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.route-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');

                // æ¸…é™¤ä¹‹å‰çš„åœ°å›¾çº¿æ¡
                if (activePolyline) map.removeLayer(activePolyline);

                // ç»˜åˆ¶æ–°è·¯çº¿
                activePolyline = L.polyline(route.coords, {
                    color: route.color,
                    weight: 5,
                    opacity: 0.8,
                    dashArray: route.tags.includes('easy') ? null : '10, 10' // è™šçº¿è¡¨ç¤ºç¨å¾®éš¾ä¸€ç‚¹
                }).addTo(map);

                // èšç„¦åœ°å›¾
                map.fitBounds(activePolyline.getBounds(), {padding: [50, 50]});
            };

            routeListEl.appendChild(card);
        });

        // 6. ç®€å•çš„è®¡æ—¶å™¨é€»è¾‘ (æ¨¡æ‹Ÿ Strava è®°å½•)
        let isRecording = false;
        let seconds = 0;
        let timerInterval;

        function toggleRecord() {
            const btn = document.querySelector('.btn-record');
            const icon = document.getElementById('play-icon');
            
            if (!isRecording) {
                // å¼€å§‹è®°å½•
                isRecording = true;
                icon.className = "fas fa-pause";
                btn.style.backgroundColor = "#ff9f43";
                timerInterval = setInterval(() => {
                    seconds++;
                    const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const s = (seconds % 60).toString().padStart(2, '0');
                    document.getElementById('timer').innerText = `${m}:${s}`;
                }, 1000);
            } else {
                // æš‚åœè®°å½•
                isRecording = false;
                icon.className = "fas fa-play";
                btn.style.backgroundColor = "var(--primary)";
                clearInterval(timerInterval);
                alert("é›ç‹—ç»“æŸï¼æœ¬æ¬¡æ¢ç´¢å·²ç”Ÿæˆ 'Sniff Report' å—…æ¢æŠ¥å‘Š ğŸ¶");
            }
        }
    </script>
</body>
</html>