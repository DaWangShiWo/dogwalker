<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WagMap - é«˜å¾·æé€Ÿç‰ˆ</title>
    
    <link href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    
    <style>
        /* 1. å…¨å±€é‡ç½®ï¼šä¿è¯å æ»¡å±å¹• */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
            overflow: hidden; /* ç¦æ­¢é¡µé¢æ»šåŠ¨ */
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif; 
        }

        /* 2. åœ°å›¾å±‚ï¼šå¼ºåˆ¶ç»å¯¹å®šä½ï¼Œé“ºæ»¡åº•å±‚ */
        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1; /* æœ€åº•å±‚ */
            background-color: #f0f0f0; /* åŠ è½½å‰çš„èƒŒæ™¯è‰² */
        }

        /* 3. ç•Œé¢å±‚ (UI)ï¼šæ‚¬æµ®åœ¨åœ°å›¾ä¹‹ä¸Š */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* åœ¨åœ°å›¾ä¸Šé¢ */
            pointer-events: none; /* è®©ç‚¹å‡»äº‹ä»¶ç©¿é€åˆ°åœ°å›¾ï¼Œé™¤éç‚¹åˆ°å…·ä½“çš„æŒ‰é’®/å¡ç‰‡ */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .top-bar {
            pointer-events: auto; /* æ¢å¤ç‚¹å‡» */
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            margin: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(5px);
        }
        .app-title { font-weight: bold; font-size: 18px; color: #333; display: flex; align-items: center; gap: 8px; }
        .user-badge { background: #FF6B6B; color: white; font-size: 12px; padding: 4px 8px; border-radius: 10px; }

        /* åº•éƒ¨è·¯çº¿åˆ—è¡¨å®¹å™¨ */
        .bottom-panel {
            pointer-events: auto; /* æ¢å¤ç‚¹å‡» */
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            max-height: 45vh; /* å æ®å±å¹•ä¸‹æ–¹ 45% */
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }

        /* æ‹–åŠ¨æ¡æç¤º */
        .drag-handle {
            width: 40px;
            height: 5px;
            background: #ddd;
            border-radius: 3px;
            margin: 10px auto;
        }

        /* è·¯çº¿åˆ—è¡¨æ»šåŠ¨åŒº */
        .route-scroll {
            overflow-y: auto;
            padding: 0 15px;
            flex: 1;
        }

        /* è·¯çº¿å¡ç‰‡æ ·å¼ */
        .route-card {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s;
        }
        .route-card.active {
            background: #fff5f0;
            border-color: #fc4c02; /* Strava Orange */
            transform: scale(0.99);
        }
        .route-icon {
            width: 40px; height: 40px;
            background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-size: 20px;
        }
        .route-details h3 { margin: 0 0 5px 0; font-size: 15px; color: #333; }
        .route-tags span {
            font-size: 10px; padding: 2px 6px; border-radius: 4px; color: white; margin-right: 5px;
        }

        /* åŠ è½½æç¤º */
        #loading-text {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #666; font-size: 14px;
            z-index: 0;
        }

        /* é€‚é…æ¡Œé¢ç«¯ï¼šä¾§è¾¹æ æ¨¡å¼ */
        @media (min-width: 768px) {
            .bottom-panel {
                position: absolute;
                top: 80px; left: 20px; bottom: 20px;
                width: 350px;
                max-height: none;
                border-radius: 12px;
                background: rgba(255,255,255,0.95);
            }
            .top-bar {
                width: 350px; margin: 20px;
                box-sizing: border-box;
            }
        }
    </style>
</head>
<body>

    <div id="loading-text">æ­£åœ¨åŠ è½½é«˜å¾·åœ°å›¾...</div>

    <div id="map"></div>

    <div id="ui-layer">
        <div class="top-bar">
            <div class="app-title"><i class="fas fa-paw" style="color:#FF6B6B"></i> é›ç‹—å»å“ªå„¿</div>
            <div class="user-badge">ç­‰çº§ Lv.3</div>
        </div>

        <div class="bottom-panel">
            <div class="drag-handle"></div>
            <div style="padding: 0 15px 10px; font-weight:bold; color:#555;">é™„è¿‘æ¨è</div>
            
            <div class="route-scroll" id="route-list">
                </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <script>
        // --- 1. åˆå§‹åŒ–åœ°å›¾ (ä½¿ç”¨é«˜å¾·åº•å›¾) ---
        // é»˜è®¤å®šä½ï¼šä¸Šæµ·äººæ°‘å¹¿åœº (æ‚¨å¯ä»¥æ”¹æˆæ‚¨æ‰€åœ¨çš„åŸå¸‚åæ ‡)
        const initLat = 31.2304;
        const initLng = 121.4737;

        const map = L.map('map', {
            zoomControl: false, // éšè—å·¦ä¸Šè§’ç¼©æ”¾æŒ‰é’®ï¼Œç•Œé¢æ›´æ¸…çˆ½
            attributionControl: false
        }).setView([initLat, initLng], 14);

        // **æ ¸å¿ƒä¿®æ”¹ï¼šä½¿ç”¨é«˜å¾·åœ°å›¾ç“¦ç‰‡ (WGS84 çº åç‰ˆ)**
        // è¿™æ˜¯è§£å†³ä¸­å›½åœ°å›¾åŠ è½½æ…¢/ç©ºç™½çš„å…³é”®
        L.tileLayer('https://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
            maxZoom: 18,
            minZoom: 3,
        }).addTo(map);

        document.getElementById('loading-text').style.display = 'none'; // åœ°å›¾åŠ è½½åéšè—æ–‡å­—

        // --- 2. æ¨¡æ‹Ÿè·¯çº¿æ•°æ® ---
        const routes = [
            {
                id: 1,
                name: "æ»¨æ±Ÿæ´»åŠ›è·‘",
                tags: ["é£æ™¯å¥½", "å¡‘èƒ¶é“"],
                color: "#FF6B6B", // çº¢è‰²
                bg: "#FF6B6B",
                path: [
                    [31.2304, 121.4737], [31.2320, 121.4780], [31.2350, 121.4760]
                ],
                icon: "ğŸƒ"
            },
            {
                id: 2,
                name: "å¹¼çŠ¬ç¤¾äº¤è‰åª",
                tags: ["å®‰å…¨", "è‰åœ°å¤š"],
                color: "#2ECC71", // ç»¿è‰²
                bg: "#2ECC71",
                path: [
                    [31.2280, 121.4700], [31.2260, 121.4680], [31.2250, 121.4720]
                ],
                icon: "ğŸ•"
            },
            {
                id: 3,
                name: "å’–å•¡é¦†æ•£æ­¥",
                tags: ["è®¾æ–½å…¨", "é¥®æ°´ç‚¹"],
                color: "#3498db", // è“è‰²
                bg: "#3498db",
                path: [
                    [31.2350, 121.4650], [31.2380, 121.4680], [31.2360, 121.4700]
                ],
                icon: "â˜•"
            }
        ];

        let currentLine = null; // å½“å‰æ˜¾ç¤ºçš„è·¯çº¿

        // --- 3. æ¸²æŸ“åˆ—è¡¨ ---
        const listContainer = document.getElementById('route-list');
        
        routes.forEach(route => {
            const card = document.createElement('div');
            card.className = 'route-card';
            
            // ç”Ÿæˆæ ‡ç­¾HTML
            let tagsHtml = route.tags.map(t => 
                `<span style="background:${route.color}">${t}</span>`
            ).join('');

            card.innerHTML = `
                <div class="route-icon">${route.icon}</div>
                <div class="route-details">
                    <h3>${route.name}</h3>
                    <div class="route-tags">${tagsHtml}</div>
                </div>
            `;
            
            // ç‚¹å‡»äº‹ä»¶
            card.onclick = () => {
                // 1. UI é€‰ä¸­æ ·å¼
                document.querySelectorAll('.route-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');

                // 2. åœ°å›¾ç»˜åˆ¶
                if (currentLine) map.removeLayer(currentLine); // æ¸…é™¤ä¸Šä¸€æ¡
                
                currentLine = L.polyline(route.path, {
                    color: route.color,
                    weight: 6,
                    opacity: 0.9
                }).addTo(map);

                // æ·»åŠ èµ·ç‚¹ç»ˆç‚¹åœ†åœˆ
                L.circleMarker(route.path[0], {radius:5, color: route.color, fillOpacity:1}).addTo(map);
                
                // 3. è‡ªåŠ¨ç¼©æ”¾é€‚åº”å±å¹•
                // é’ˆå¯¹æ‰‹æœºç«¯ï¼Œåº•éƒ¨ç•™å‡º 40% çš„ç©ºé—´ç»™åˆ—è¡¨ï¼Œé˜²æ­¢è·¯çº¿è¢«æŒ¡ä½
                map.fitBounds(currentLine.getBounds(), {
                    paddingBottomRight: [0, window.innerHeight * 0.45], 
                    paddingTopLeft: [0, 50]
                });
            };

            listContainer.appendChild(card);
        });

        // è§£å†³éƒ¨åˆ†æ‰‹æœºæµè§ˆå™¨é«˜åº¦è®¡ç®—å»¶è¿Ÿçš„é—®é¢˜
        setTimeout(() => {
            map.invalidateSize();
        }, 500);

    </script>
</body>
</html>
